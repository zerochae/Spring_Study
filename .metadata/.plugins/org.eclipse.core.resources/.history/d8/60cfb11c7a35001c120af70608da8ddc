<%@page import="java.util.ArrayList"%>
<%@page import="kr.or.ddit.guestbook.vo.Product"%>
<%@page import="java.sql.DriverManager"%>
<%@page import="jdbc.JdbcUtil"%>
<%@page import="java.sql.SQLException"%>
<%@page import="java.sql.ResultSet"%>
<%@page import="java.sql.PreparedStatement"%>
<%@page import="java.sql.Connection"%>
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%
   String id = request.getParameter("id");
   if(id == null || id.trim().equals("")) {
      //response 내장 객체를 통해 상품 목록으로 이동
      response.sendRedirect("products.jsp");
      //밑의 구문은 더 이상 실행하지 않음
      return ;
   }
   
   Connection conn = null;
   PreparedStatement pstmt = null;
   ResultSet rs = null;
   
   try {
      conn = DriverManager.getConnection("jdbc:apache:commons:dbcp:ddit");
      String sql = "select * from product where p_id = ?";
      pstmt = conn.prepareStatement(sql);
      pstmt.setString(1,id);
      rs = pstmt.executeQuery();
       
      //기본 생성자를 통한 객체 생성
      Product product = new Product();
      if(rs.next()) {
         //id에 해당하는 상품정보를 select하여 Product 객체에 setting   
         product.setProductId(rs.getString("P_ID"));
         product.setPname(rs.getString("P_NAME"));
         product.setUnitprice(rs.getInt("P_UNITPRICE"));
         product.setDescription(rs.getString("P_DESCRIPTION"));
         product.setCategory(rs.getString("P_CATEGORY"));
         product.setManufacturer(rs.getString("P_MANUFACTURER"));
         product.setUnitsinstock(rs.getInt("P_UNITSINSTOCK"));
         product.setCondition(rs.getString("P_CONDITION"));
         product.setFilename(rs.getString("P_FILENAME"));
         //상품을 세션에 담음
          ArrayList<Product> list = (ArrayList<Product>)session.getAttribute("cartlist");
      } else {
    	  response.sendRedirect("exceptionNoProductId.jsp");
      }
   } catch(SQLException e) {
      e.printStackTrace();
   } finally {
      JdbcUtil.close(rs);
      JdbcUtil.close(conn);
      JdbcUtil.close(pstmt);
   }
%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>

</body>
</html>